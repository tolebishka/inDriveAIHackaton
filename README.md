inDrive Car Damage & Cleanliness Detector

Мобильное приложение на SwiftUI + CoreML, которое позволяет определять повреждения автомобиля (царапины, вмятины, ржавчина) и уровень чистоты по фотографии или в реальном времени с камеры.

Функционал

Загрузка фото из галереи

Съемка с помощью камеры

Реал-тайм детектор (обнаружение дефектов сразу при наведении камеры)

Поддержка двух ML-моделей:

ScratchDet (специализированная для царапин)

DamageAll (обобщённая для царапин, вмятин и ржавчины)

Автоматическое слияние результатов моделей (NMS, приоритет по классам)

Красивый UI: боксы на фото, статусные бейджи, список найденных дефектов

Расчет уверенности (%) и процентной площади повреждений

Установка и запуск
1. Клонируй репозиторий
git clone https://github.com/username/inDriveDamageDetector.git
cd inDriveDamageDetector

2. Открой проект в Xcode

Открой inDriveApp.xcodeproj или .xcworkspace в Xcode.

3. Установи модели

В проект уже включены:

model.mlmodel

weight.bin

Manifest.json

Они автоматически подхватываются через ScratchDet и DamageAll.
При необходимости замени на свои .mlpackage модели.

4. Запусти на симуляторе или устройстве
⌘ + R


Для работы камеры и real-time режима нужно запускать на реальном устройстве (iPhone/iPad).

Использование приложения

При запуске откроется экран Car Damage Detect.

Доступны три кнопки:

Галерея – выбрать фото машины из библиотеки.

Камера – сделать снимок.

Реал-тайм – запустить live-детекцию с камеры.

После выбора изображения/видео:

Алгоритм запускает ML-модель.

Повреждения подсвечиваются прямоугольниками.

Появляется список найденных областей: класс, процент уверенности и площадь.

Вверху отображается статус:

«Повреждения не обнаружены»

«Незначительные / Средние / Существенные»

Архитектура проекта

inDriveApp.swift — точка входа в приложение

DamageDetectorView.swift — основной экран (галерея/камера/реал-тайм + вывод детекций)

CameraPicker.swift — интеграция с нативной камерой iOS

CameraPipeline.swift — обработка live-потока (AVFoundation → ML → detections)

CameraPreview.swift — встраивание камеры в SwiftUI

CarDamageDetector.swift — класс-обертка для CoreML модели

CombinedDamageDetector.swift — объединение двух моделей, NMS, приоритеты

LiveContainerView.swift — контейнер для real-time режима

Пример работы

Загрузи фото с царапиной → увидишь bounding box «Scratch 87% (3.2% площади)»

Наведи камеру на машину → появятся боксы «Dent» или «Rust» в реальном времени

Настройка

Пороги уверенности и площади можно менять в CarDamageDetector.swift:

var confidenceThreshold: Float = 0.35
var minArea: CGFloat = 0.01


Для объединения моделей правила приоритета и IoU настроены в CombinedDamageDetector.swift.
